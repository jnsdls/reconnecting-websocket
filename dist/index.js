!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ReconnectingWebSocket=t():e.ReconnectingWebSocket=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r={debug:!1,automaticOpen:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"},c=!1,i=!1,s=null,a=function(e,t,n){return n?console.debug("ReconnectingWebSocket -- on"+e+" not implemented",t):null},u=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(this,e),!(window&&"WebSocket"in window))throw new Error("ReconnectingWebSocket currently only supports browsers who have native WebSocket support.");this.url=t,this.readyState=WebSocket.CONNECTING,this.reconnectAttempts=0,this.options=Object.assign({},r,o),this.CONNECTING=WebSocket.CONNECTING,this.OPEN=WebSocket.OPEN,this.CLOSING=WebSocket.CLOSING,this.CLOSED=WebSocket.CLOSED,this.options.automaticOpen&&this.open()}return o(e,[{key:"open",value:function(e){var t=this;if(s=new WebSocket(this.url),s.binaryType=this.options.binaryType,i=!1,e&&this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return this.on("maxretry");this.on("connecting");var n=setTimeout(function(){t.on("connect-timeout"),i=!0,s.close()},this.options.timeoutInterval);return s.onopen=function(){clearTimeout(n),t.protocol=s.protocol,t.readyState=WebSocket.OPEN,t.reconnectAttempts=0,t.on("open",{url:t.url,reconnectAttempt:e})},s.onclose=function(o){if(clearTimeout(n),s=null,c)t.readyState=WebSocket.CLOSED,t.on("close");else{t.readyState=WebSocket.CONNECTING;var r=t.options.reconnectInterval*Math.pow(t.options.reconnectDecay,t.reconnectAttempts),a=r>t.options.maxReconnectInterval?t.options.maxReconnectInterval:r,u=o.code,l=o.reason,p=o.wasClean;t.on("connecting",{code:u,reason:l,wasClean:p,retryTimeout:a,reconnectAttempts:t.reconnectAttempts}),e||i||t.on("close",{url:t.url}),setTimeout(function(){t.reconnectAttempts++,t.open(!0)},a)}},s.onmessage=function(e){var n=e.data;t.on("message",{data:n})},s.onerror=function(e){t.on("error",{event:e})},null}},{key:"send",value:function(e){if(s)return this.on("send",{url:this.url,data:e}),s.send(e);throw new Error("INVALID_STATE_ERR : Pausing to reconnect websocket")}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c=!0,s&&(this.readyState=WebSocket.CLOSING,this.on("closing"),s.close(e,t))}},{key:"refresh",value:function(){s&&(this.readyState=WebSocket.CLOSING,this.on("closing"),s.close())}},{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({},t,{event:e}),o=this.options.debug;switch(e){case"maxretry":return this.onMaxRetry?this.onMaxRetry(n):a(e,n,o);case"connecting":return this.onConnecting?this.onConnecting(n):a(e,n,o);case"connect-timeout":return this.onConnectTimeout?this.onConnectTimeout(n):a(e,n,o);case"open":return this.onOpen?this.onOpen(n):a(e,n,o);case"close":return this.onClose?this.onClose(n):a(e,n,o);case"message":return this.onMessage?this.onMessage(n):a(e,n,o);case"send":return this.onSend?this.onSend(n):a(e,n,o);case"closing":return this.onClosing?this.onClosing(n):a(e,n,o);case"error":return this.onError?this.onError(n):a(e,n,!0);default:return a(e,n,o)}}}]),e}();t.default=u}])});